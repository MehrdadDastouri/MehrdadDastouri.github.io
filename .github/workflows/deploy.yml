# Ù†Ø§Ù… workflow Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø± ØªØ¨ Actions
name: Build and Deploy Jekyll site to GitHub Pages

# ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø§ÛŒÙ† workflow Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
on:
  # Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ø¨Ù‡ Ø´Ø§Ø®Ù‡ main Ù¾ÙˆØ´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯
  push:
    branches: ["main"] # Ø§Ú¯Ø± Ù†Ø§Ù… Ø´Ø§Ø®Ù‡ Ø§ØµÙ„ÛŒ Ø´Ù…Ø§ master Ø§Ø³ØªØŒ Ø§ÛŒÙ† Ø±Ø§ Ø¨Ù‡ "master" ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
  # Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø§ÛŒÙ† workflow Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ø§Ø² ØªØ¨ Actions Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
  workflow_dispatch:

# ØªÙ†Ø¸ÛŒÙ… Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ workflow (Ø±ÙˆØ´ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø§Ù…Ù†)
permissions:
  contents: read
  pages: write
  id-token: write

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ú†Ù†Ø¯ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ)
concurrency:
  group: "pages"
  cancel-in-progress: true

# ØªØ¹Ø±ÛŒÙ Ú©Ø§Ø±Ù‡Ø§ (Jobs) Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆÙ†Ø¯
jobs:
  # Ú©Ø§Ø± Ø§ÙˆÙ„: Ø³Ø§Ø®Øª Ø³Ø§ÛŒØª
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Ruby and Bundler ğŸ’
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "3.2" # Ù†Ø³Ø®Ù‡ Ø±ÙˆØ¨ÛŒ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Gemfile ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯
          bundler-cache: true # Ú©Ø´ Ú©Ø±Ø¯Ù† Gem Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª

      - name: Setup Python ğŸ
        uses: actions/setup-python@v5
        with:
          python-version: "3.11" # ÛŒÚ© Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ø§Ø² Ù¾Ø§ÛŒØªÙˆÙ†
          cache: "pip"

      - name: Setup Node.js for PurgeCSS ğŸ§¹
        uses: actions/setup-node@v4
        with:
          node-version: "18" # Ù†Ø³Ø®Ù‡ LTS Ù†ÙˆØ¯

      - name: Update _config.yml for Giscus âš™ï¸
        uses: fjogeleit/yaml-update-action@main
        with:
          commitChange: false
          valueFile: "_config.yml"
          propertyPath: "giscus.repo"
          value: ${{ github.repository }}

      - name: Install Dependencies and Build Site ğŸ”§
        run: |
          # Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„
          sudo apt-get update && sudo apt-get install -y imagemagick
          # Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
          pip3 install --upgrade nbconvert
          # Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Node.js Ø¨Ø±Ø§ÛŒ PurgeCSS
          npm install -g purgecss
          # Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ruby
          bundle install
          # Ø³Ø§Ø®Øª Ø³Ø§ÛŒØª
          export JEKYLL_ENV=production
          bundle exec jekyll build

      - name: Purge unused CSS after build ğŸ§¹
        run: purgecss -c purgecss.config.js

      - name: Upload artifact for deployment ğŸ“¦
        uses: actions/upload-pages-artifact@v3
        with:
          path: "./_site"

  # Ú©Ø§Ø± Ø¯ÙˆÙ…: Ø§Ù†ØªØ´Ø§Ø± Ø³Ø§ÛŒØª
  deploy:
    # Ø§ÛŒÙ† job ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ job 'build' Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨Ø§Ø´Ø¯
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages ğŸš€
        id: deployment
        uses: actions/deploy-pages@v4
